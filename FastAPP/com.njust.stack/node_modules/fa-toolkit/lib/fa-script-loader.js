"use strict";var _utils=require("./utils"),_parser=require("./parser"),_shared=require("./shared");module.exports=function(r,i){this.cacheable&&this.cacheable();var p=this.async(),c=this;_parser.parseScript(r).then(function(r){var e=r.parsed,a=_shared.updateSourceScript(e);e=a.fileCont,_utils.logWarn(c,a.logFeatureList);var s=e.match(/require\s*\(['"]@(system|service|card|android|hap)([^()'"\s]*)['"]\)/g);s&&0<s.length&&s.forEach(function(r){e=e.replace(r,r.replace("require","$app_require$").replace("@","@app-module/"))});var t=e.match(/import\s+([^()'";]+)\s+from\s+['"]@(system|service|card|android|hap)([^()'"\s]*)['"]/g);t&&0<t.length&&t.forEach(function(r){e=e.replace(r,r.replace("import","var").replace("from","= $app_require$(").replace("@","@app-module/")+");")}),p(null,"module.exports = function(module, exports, $app_require$){"+e+"}",i)}).catch(function(r){_utils.logWarn(c,[{reason:"ERROR: Script parsing error: "+r}]),p(null,"{}")})};