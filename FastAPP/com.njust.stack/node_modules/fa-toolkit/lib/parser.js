"use strict";var _parse=require("parse5"),_transform=require("./transform"),_template=require("./template"),_style=require("./style"),_script=require("./script"),_validator=require("./template/validator"),_utils=require("./utils");function getAttribute(e,t){if(e.attrs)for(var r=e.attrs.length;r--;){var a=e.attrs[r];if(a.name===t)return a.value}}function extractDependencies(e,t){e.childNodes&&e.childNodes.forEach(function(e){_validator.default.checkTagName(e,{result:{},depends:t,log:[]}),extractDependencies(e,t)})}function parseFragment(e){var t=_parse.parseFragment(e,{treeAdapter:_parse.treeAdapters.default,locationInfo:!0}),i={depends:[],import:[],template:[],style:[],script:[],data:[],config:[]};return t.childNodes.forEach(function(e){var t=void 0;if("script"===e.tagName?"data"!==(t=getAttribute(e,"type"))&&(t="script"):t=e.tagName,i[t]){var r=getAttribute(e,"name"),a=getAttribute(e,"src"),s=getAttribute(e,"lang");if(i[t].push({name:r,src:a,lang:s,node:e}),"template"===t){var n=[];extractDependencies(e.content,n),i.depends=n}}}),i}function extractBlocks(e,s){return new Promise(function(r,a){_transform.format(e,function(e,t){e?a(e):r(t[s])})})}function parseTemplate(e){return new Promise(function(a,s){_template.default.parse(e,function(e,t){if(e)s(e);else{var r=JSON.stringify(t.jsonTemplate,_utils.stringifyFunction,"  ");r=r.replace(_utils.FUNC_START_REG,"").replace(_utils.FUNC_END_REG,""),a({parsed:r,log:t.log})}})})}function parseStyle(e){return new Promise(function(a,s){_style.parse(e,function(e,t){if(e)s(e);else{var r=JSON.stringify(t.jsonStyle,null,2);a({parsed:r,log:t.log})}})})}function parseScript(r){return new Promise(function(e,t){e({parsed:_script.fix(r)})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseFragment=parseFragment,exports.extractBlocks=extractBlocks,exports.parseTemplate=parseTemplate,exports.parseStyle=parseStyle,exports.parseScript=parseScript;