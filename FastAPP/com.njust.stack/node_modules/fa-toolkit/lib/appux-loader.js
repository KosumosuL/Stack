"use strict";var loaderUtils=require("loader-utils"),path=require("path"),fs=require("fs"),parser=require("./parser"),utils=require("./utils"),packagePath=path.resolve(__dirname,"../package.json"),defaultLoaders={component:path.resolve(__dirname,"loader.js"),fragment:path.resolve(__dirname,"fa-fragment-loader.js"),script:path.resolve(__dirname,"fa-script-loader.js"),babel:utils.loadBabelModule("babel-loader"),appscript:path.resolve(__dirname,"fa-app-script-loader.js")};function makeLoaderString(e,r){r=r||{};var a=void 0;return"script"===e&&(a=[{name:defaultLoaders.script},{name:defaultLoaders.appscript,query:{path:r.path,versionNum:r.versionNum}},{name:defaultLoaders.babel,query:{presets:[utils.loadBabelModule("@babel/preset-env")],plugins:[utils.loadBabelModule("@babel/plugin-transform-modules-commonjs")],comments:"false"}}],r.source||a.push({name:defaultLoaders.fragment,query:{index:0,type:"scripts"}})),utils.stringifyLoaders(a)}function loader(e,r){var a,p=loaderUtils.parseQuery(e.resourceQuery),s=p.entry,t=e.resourcePath,o=e.options.versionNum,i=path.relative(".",t);a=s?i:p.name||utils.getNameByPath(t),utils.print({query:e.loaderQuery,resourceQuery:e.resourceQuery,resourcePath:e.resourcePath,name:a});var l="",u=parser.parseFragment(r);if(u.script.length){var n=u.script[0],d=t;n.src&&(d=n.src);var c=makeLoaderString("script",{source:n.src,path:t,versionNum:o});l+="var $app_script$ = "+utils.makeRequireString(p,c,d)}return l+="\n$app_define$('@app-application/"+a+"', [], function($app_require$, $app_exports$, $app_module$){\n",0<u.script.length&&(l+="     $app_script$($app_module$, $app_exports$, $app_require$)\n",l+="     if ($app_exports$.__esModule && $app_exports$.default) {\n            $app_module$.exports = $app_exports$.default\n        }\n"),l+="})\n",l+="\n$app_bootstrap$('@app-application/"+a+"',{ packagerName:'fa-toolkit', packagerVersion: '"+JSON.parse(fs.readFileSync(packagePath).toString()).subversion.packager+"'})"}module.exports=loader;