"use strict";function checkTagName(e,t){var a=t.result,n=t.depends,l=t.log,i=e.tagName,o=e.childNodes||[],c=e.__location||{};if(tagAliasMap[i]&&("img"!==i&&l.push({line:c.line||1,column:c.col||1,reason:"NOTE: Component name `"+i+"` is automatically converted to `"+tagAliasMap[i]+"`."}),i=tagAliasMap[i]),a.type=i,0<=RESERVED_TAGS.indexOf(i)&&l.push({line:c.line||1,column:c.col||1,reason:"ERROR: Component name `"+i+"` is invalid. Please change it."}),e._isroot&&0<=tagNotRoot.indexOf(i)&&l.push({line:c.line||1,column:c.col||1,reason:"ERROR: Component `"+i+"` cannot be used as the root component."}),n.indexOf(i)<0&&"string"==typeof i&&!tagNatives[i]&&(n.push(i),1<o.length)){var r=[];o.forEach(function(e){"slot"===e.nodeName&&e.attrs&&e.attrs.forEach(function(e){e.name&&"name"===e.name&&(r.indexOf(e.value)<0?r.push(e.value):l.push({line:c.line||1,column:c.col||1,reason:"WARNING: Component`"+i+"` is not allowed to have multiple names with the same name `"+e.value+"`in slot declaration."}))})})}0<=tagAtomics.indexOf(i)&&(tagTextCotent.indexOf(i)<0?0<o.length&&o.every(function(e){return"#text"===e.nodeName||(l.push({line:c.line||1,column:c.col||1,reason:"ERROR: `"+i+"` is an atom component, which cannot not have subnodes."}),!1)}):(1<o.length||o[0]&&"#text"!==o[0].nodeName)&&l.push({line:c.line||1,column:c.col||1,reason:"ERROR: Component `"+i+"` can have only one text subnode."}));var u=e.attrs||[],p=[];if(u.forEach(function(e){p.push(e.name.toLowerCase())}),a.attr=a.attr||{},tagAttrMap[i]&&p.forEach(function(e){e.match(/^(on|@)/)||e in tagAttrMap[i]||(e in tagCommon.attrs?l.push({line:c.line||1,column:c.col||1,reason:"ERROR: Component `"+i+"` does not support the attribute `"+e+"`."}):checkDataAttr(e)||"slot"===e||l.push({line:c.line||1,column:c.col||1,reason:"WARNING: Component `"+i+"` has a customized attribute `"+e+"`."}))}),"slot"===i&&u.forEach(function(e){e.name&&_exp.containExpr(e.value)&&l.push({line:c.line||1,column:c.col||1,reason:"WARNING: Component `"+i+"` attribute `"+e.name+"`only support Stringï¼Œdoes not support data binding:`"+e.value+"`."})}),tagDefaultAttrMap[i]&&Object.keys(tagDefaultAttrMap[i]).forEach(function(e){var t=p.indexOf(e);0<=t&&""===u[t].value&&(u[t].value=tagDefaultAttrMap[i][e],l.push({line:c.line||1,column:c.col||1,reason:"ERROR: Component `"+i+"` attribute `"+e+"` value is blank."}))}),e._isroot&&tagRootAttrMap[i]&&tagRootAttrMap[i].forEach(function(e){0<=p.indexOf(e)&&l.push({line:c.line||1,column:c.col||1,reason:"ERROR: Root node `"+i+"` cannot use the attribute `"+e+"`."})}),tagRequireAttrMap[i]&&tagRequireAttrMap[i].forEach(function(e){p.indexOf(e)<0&&l.push({line:c.line||1,column:c.col||1,reason:"ERROR: Component `"+i+"` Missing required attribute `"+e+"`."})}),tagEnumAttrMap[i]&&Object.keys(tagEnumAttrMap[i]).forEach(function(e){var t=p.indexOf(e);if(0<=t){var a=u[t].value.trim();if(!_exp.isExpr(a)){var n=tagEnumAttrMap[i][e];n.indexOf(a)<0&&(u[t].value=n[0],l.push({line:c.line||1,column:c.col||1,reason:"ERROR: Component `"+i+"` attribute `"+e+"` value `"+a+"`is invalid."}))}}}),tagFuncAttrMap[i]&&Object.keys(tagFuncAttrMap[i]).forEach(function(e){var t=p.indexOf(e);if(0<=t){var a=u[t].value;if(!_exp.isExpr(a)){var n=tagFuncAttrMap[i][e],o=_style.validator[n];if("function"==typeof o){var r=o(a);if(r&&r.reason){u[t].value=r.value;var s=r.reason(e,a,r.value);l.push({line:c.line||1,column:c.col||1,reason:s})}}}}}),tagChildAttrsMap[i]&&Object.keys(tagChildAttrsMap[i]).forEach(function(e){var t=p.indexOf(e);if(0<=t){var a=u[t].value;if(!_exp.isExpr(a)){var n=_childAttsConfig.validator[e];if("function"==typeof n){var o=n(a);if(o&&o.reason){u[t].value=o.value;var r=o.reason(e,a,o.value);l.push({line:c.line||1,column:c.col||1,reason:r})}}}}}),tagEventsMap[i]){var s=tagEventsMap[i];p.forEach(function(e){if(e.match(/^(on|@)/)){var t=e.replace(/^(on|@)/,"");s.indexOf(t.toLowerCase())<0&&l.push({line:c.line||1,column:c.col||1,reason:"ERROR: Component `"+i+"` does not support the event `"+i+"`."})}})}if(isReservedTag(i)&&0<o.length){var h=tagChildrenMap[i],m="tabs"===i,d=void 0,f=void 0,g=[];m&&(f=d=0),o.forEach(function(e){if(isReservedTag(e.nodeName)){var t=tagParentsMap[e.nodeName];if((t&&t.indexOf(i)<0||h&&h.indexOf(e.nodeName)<0)&&l.push({line:c.line||1,column:c.col||1,reason:"ERROR: Component `"+i+"` does not support the sub-component `"+e.nodeName+"`."}),m){var a=0;"tab-content"===e.nodeName?a=++d:"tab-bar"===e.nodeName&&(a=++f),1<a&&l.push({line:c.line||1,column:c.col||1,reason:"ERROR: Component `tabs` supports only one sub-component  `"+e.nodeName+"`."})}if("slot"===i&&"slot"===e.nodeName&&l.push({line:c.line||1,column:c.col||1,reason:"WARNING: Component `slot` does not support nesting `"+e.nodeName+"`."}),"slot"===e.nodeName)(e.attrs||[]).forEach(function(e){"name"===e.name&&(g.indexOf(e.value)<0?g.push(e.value):l.push({line:c.line||1,column:c.col||1,reason:"WARNING: Component`"+i+"` is not allowed to have multiple names with the same name `"+item.value+"`in slot declaration."}))})}})}}function checkDataAttr(e){return REG_TAG_DATA_ATTR.test(e)}function checkId(e,t){e&&(_exp.isExpr(e)?t.result.id=_exp(e):t.result.id=e)}function checkBuild(e,t){e&&(t.result.append="tree"===e?"tree":"single")}function checkClass(classNames,nodeinfo){(classNames=classNames.trim())&&(_exp.containExpr(classNames)?nodeinfo.result.classList=eval(_exp.transExprForList(classNames)):nodeinfo.result.classList=classNames.split(/\s+/))}function getCssMap(a){var e=a.match(URL_MATCH_G);e&&0<e.length&&e.forEach(function(e){var t=e.replace(";","@@0@@");a=a.replace(e,t)});var t=[],n=a.trim().split(";");if(n&&0<n.length)for(var o=0,r=n.length;o<r;o++)if(0!==n[o].length){var s=n[o].match(/^\s*[\w-]+\s*:/),l={};if(!s||1!==s.length)throw new Error(" An error occurred when parsing the inline style: '"+n[o]+"' . For data binding, configure minPlatformVersion >= 1040.");if(l.value=n[o].substring(s[0].length,n[o].length).trim().replace("@@0@@",";"),l.key=_utils.hyphenedToCamelCase(n[o].substring(0,s[0].length-1).trim()),_exp.containExpr(l.value)){if("border"===l.key||"mylocation"===l.key)throw new Error("Inline style parsing error: '"+l.key+"' shorthand inline style does not support data binding.");l.value=_exp(l.value),l.expType=!0}t.push(l)}return t}function translateCssBorder(n,e){e.split(/\s+/).forEach(function(e){var t=JSON.parse(e);if("Width"===t.type||"Color"===t.type){var a=["borderTop"+t.type,"borderRight"+t.type,"borderBottom"+t.type,"borderLeft"+t.type];_utils.splitAttr(n,t.value,a)}else n.borderStyle=t.value})}function translateCssBorderLRTB(n,e,o){e.split(/\s+/).forEach(function(e){var t=JSON.parse(e);if("Width"===t.type||"Color"===t.type||"Style"===t.type){var a=[o+t.type];_utils.splitAttr(n,t.value,a)}})}function translateCssBorderWidth(e,t){_utils.splitAttr(e,t,["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"])}function translateCssMylocation(a,e){var t=e.split(/\s+/),n=[];t.forEach(function(e){var t=JSON.parse(e);"Color"===t.type?n.push(t.value):a.mylocationIconPath=t.value}),a.mylocationFillColor=n[0],a.mylocationStrokeColor=n[1]}function checkStyle(e,n,o,r){if(e){if(1040<=n.versionNum&&_exp.singleExpr(e))return void(n.result.style=_exp(e));var s={},l=n.log;getCssMap(e).forEach(function(e){if(!e.expType){"img"!==r&&"image"!==r||"objectFit"===e.key&&(e.key="objectFitImage");var t=_style.validateDelaration(e.key,e.value);if(t.value&&t.value.isRelative){var a=t.value.value;a.match(/^\.\.\/|^\.\//)&&(t.value=_style.relativePath2fullPath(a,_path.dirname(n.filePath)))}e.value=t.value,t.log&&("objectFitImage"===e.key&&(t.log.reason=t.log.reason.replace("object-fit-image","object-fit").replace("`cover` is the default value","`cover` is the default value in image")),"objectFit"===e.key&&(t.log.reason=t.log.reason.replace("`contain` is the default value","`contain` is the default value in video")),l.push({line:o.line||1,column:o.col||1,reason:t.log.reason}))}"border"===e.key?translateCssBorder(s,e.value):"borderLeft"===e.key||"borderRight"===e.key||"borderTop"===e.key||"borderBottom"===e.key?translateCssBorderLRTB(s,e.value,e.key):"borderWidth"!==e.key||e.expType?"mylocation"===e.key?translateCssMylocation(s,e.value):"number"!=typeof e.value&&"string"!=typeof e.value&&"function"!=typeof e.value||("objectFitImage"===e.key&&(e.key="objectFit"),s[e.key]=e.value):translateCssBorderWidth(s,e.value)}),n.result.style=s}}function buildConditionExp(e){return e.map(function(e){return"!("+e+")"}).join(" && ")}function checkIf(e,t,a,n,o){var r=t.log;e?(e=_exp.addExprffix(e.trim()),a?e="{{"+buildConditionExp(o)+"}}":(0<o.length&&(o.length=0),o.push(""+e.substr(2,e.length-4))),t.result.shown=_exp(e)):a||r.push({line:n.line||1,column:n.col||1,reason:"WARNING: The If attribute is null."})}function checkElse(e,t,a,n){checkIf(e,t,!0,a,n),n.length=0}function checkElif(e,t,a,n,o){var r=a.log,s=t;return e?(s="{{("+(e=_exp.addExprffix(e.trim())).substr(2,e.length-4)+") && "+buildConditionExp(o)+"}}",a.result.shown=_exp(s),o.push(""+e.substr(2,e.length-4))):r.push({line:n.line||1,column:n.col||1,reason:"WARNING: The Elif attribute is null."}),s}function checkFor(e,t,a){var n=t.log;if(e){var o=void 0,r=void 0,s=(e=_exp.removeExprffix(e)).match(/(.*) (?:in) (.*)/);if(s){var l=s[1].match(/\((.*),(.*)\)/);r=l?(o=l[1].trim(),l[2].trim()):s[1].trim(),e=s[2]}e="{{"+e+"}}";var i=void 0;o||r?(i={exp:_exp(e)},o&&(i.key=o),r&&(i.value=r)):i=_exp(e),t.result.repeat=i}else n.push({line:a.line||1,column:a.col||1,reason:"WARNING: The for attribute is null."})}function checkEvent(e,t,a){var n=t,o=e.replace(/^(on|@)/,"");if(o&&t){var r=(n=_exp.removeAllExprFix(t.trim())).match(/(.*)\((.+)\)/);if(r){var s=r[1],l=r[2];n=_exp.transExprForEvent(s,l)}else/(.*)\(\s*\)/.test(n)&&(n=n.substring(0,n.indexOf("(")));a.result.events=a.result.events||{},a.result.events[o]=n}}function checkAttr(e,t,a,n,o){!e||"number"!=typeof t&&"string"!=typeof t||(a.result.attr=a.result.attr||{},-1!==tagPathAttr.indexOf(e)&&t.match(/^\.\.\/|^\.\//)&&(t=_style.relativePath2fullPath(t,_path.dirname(a.filePath))),0<a.widgetsPathList.indexOf(a.filePath)&&(t=_style.trans2Base64(t,a.filePath)),a.result.attr[_utils.hyphenedToCamelCase(e)]=_exp(t),"value"===e&&"text"===n&&a.log.push({line:o.line,column:o.column,reason:"WARNING: `"+t+"` should be written in the text tag."}))}function isReservedTag(e){return-1<tagReserved.indexOf(e)}function isTextContentAomtic(e){return-1<tagTextCotent.indexOf(e)&&-1<tagAtomics.indexOf(e)}function isSupportSpan(e){if(e&&"string"==typeof e)return tagChildrenMap[e]&&-1<tagChildrenMap[e].indexOf("span")}function getTagChildren(e){if(e&&"string"==typeof e)return tagChildrenMap[e]||[]}function isSupportedSelfClosing(e){return!(!e||"string"!=typeof e||(e=tagAliasMap[e]||e,!tagNatives[e]))&&!!tagNatives[e].selfClosing}Object.defineProperty(exports,"__esModule",{value:!0});var RESERVED_TAGS=["template","import","script","style"],URL_MATCH_G=/url\(\s*['"]?\s*([^()]+?)\s*['"]?\s*\)/g,REG_TAG_DATA_ATTR=/^data-\w+/,_exp=require("./exp"),_style=require("../style"),_utils=require("../utils"),_path=require("path"),_childAttsConfig=require("./child-attrs-config"),tagCommon={events:["click","focus","blur","longpress","appear","disappear","swipe","touchstart","touchmove","touchcancel","touchend","resize","keydown","menubuttonpress","key"],attrs:{id:{},style:{},class:{},disabled:{enum:["false","true"]},if:{excludeRoot:!0,def:"true"},elif:{def:"true"},else:{excludeRoot:!0},for:{excludeRoot:!0},tid:{},show:{excludeRoot:!0,def:"true"}},children:["block","slot"],parents:["block"]},tagNatives={div:{},a:{textContent:!0,children:["span"],attrs:{visited:{enum:["false","true"]},href:{},value:{}}},text:{textContent:!0,children:["a","span"],attrs:{type:{enum:["text","html"]},value:{}}},span:{textContent:!0,excludeRoot:!0,parents:["text","a","span"],children:["span"],uevents:[],uattrs:{id:{},style:{},class:{},for:{},tid:{},if:{def:"true"},elif:{def:"true"},else:{},value:{}}},image:{alias:["img"],events:["error","complete"],atomic:!0,selfClosing:!0,attrs:{src:{checkPath:!0},alt:{checkPath:!0}}},slider:{atomic:!0,selfClosing:!0,events:["change"],attrs:{enabled:{enum:["true","false"]},min:{def:0,checkFunc:"number"},max:{def:100,checkFunc:"number"},step:{def:1,checkFunc:"number"},value:{def:0,checkFunc:"number"}}},web:{atomic:!0,events:["pagestart","pagefinish","titlereceive","error","message"],uevents:[],attrs:{src:{},trustedurl:{},allowthirdpartycookies:{enum:["false","true"]},type:{},opacity:{def:255,checkFunc:"number"}}},list:{events:["scroll","scrollbottom","scrolltop","scrollend","scrolltouchup"],children:["list-item"],attrs:{scrollpage:{enum:["false","true"]}}},"list-item":{excludeRoot:!0,parents:["list"],attrs:{type:{required:!0}}},block:{excludeRoot:!0,uattrs:{for:{},tid:{},if:{def:"true"},elif:{def:"true"},else:{}}},slot:{excludeRoot:!0,uattrs:{content:{},name:{}}},input:{atomic:!0,selfClosing:!0,events:["change","enterkeyclick","selectionchange"],attrs:{disable:{enum:["false","true"]},checked:{enum:["false","true"]},type:{enum:["text","button","checkbox","email","date","time","number","password","radio"]},name:{},value:{},placeholder:{},enterkeytype:{enum:["default","next","go","done","send","search"]},maxlength:{checkFunc:"number"},accept:{},capture:{}}},marquee:{atomic:!0,events:["bounce","finish","start"],attrs:{scrollamount:{def:6,checkFunc:"length"},loop:{def:-1,checkFunc:"number"},direction:{enum:["left","right"]}}},refresh:{events:["refresh"],uevents:[],attrs:{refreshing:{enum:["false","true"]},offset:{checkFunc:"length"},type:{enum:["auto","material","overscroll","pulldown"]}}},swiper:{events:["change"],attrs:{autoplay:{enum:["false","true"]},indicator:{enum:["true","false"]},index:{checkFunc:"number"},interval:{checkFunc:"number"},loop:{enum:["true","false"]},duration:{checkFunc:"number"},vertical:{enum:["false","true"]},previousmargin:{},nextmargin:{}}},progress:{atomic:!0,selfClosing:!0,attrs:{type:{enum:["horizontal","circular"]},percent:{checkFunc:"number"}}},picker:{events:["change","columnchange","cancel"],atomic:!0,selfClosing:!0,uevents:["focus","blur","longpress","appear","disappear","swipe","touchstart","touchmove","touchcancel","touchend"],attrs:{type:{required:!0,enum:["text","date","time","multi-text"]},start:{checkFunc:"date"},end:{checkFunc:"date"},range:{},selected:{},value:{}}},switch:{events:["change"],selfClosing:!0,attrs:{checked:{enum:["false","true"]}}},label:{textContent:!0,atomic:!0,attrs:{target:{},value:{}},uevents:[]},textarea:{atomic:!0,textContent:!0,events:["change","selectionchange"],attrs:{placeholder:{},type:{enum:["text","email","date","time","number"]},value:{},maxlength:{checkFunc:"number"}}},video:{atomic:!0,events:["start","pause","finish","error","prepared","fullscreenchange","timeupdate","seeked","seeking"],attrs:{autoplay:{enum:["false","true"]},poster:{checkPath:!0},src:{checkPath:!0},muted:{enum:["false","true"]},controls:{enum:["true","false"]}}},audio:{atomic:!0,attrs:{streamType:{enum:["music","voicecall"]}}},camera:{atomic:!0,events:["error"],attrs:{deviceposition:{enum:["back","front"]},flash:{enum:["auto","on","off","torch"]}}},map:{atomic:!0,events:["loaded","regionchange","tap","markertap","callouttap","controltap","indoormodechange","poitap"],attrs:{longitude:{checkFunc:"number"},latitude:{checkFunc:"number"},scale:{def:11,checkFunc:"number"},rotate:{def:0,checkFunc:"number"},markers:{def:0,checkChildAttrs:!0},showmylocation:{enum:["false","true"]},polylines:{checkChildAttrs:!0},circles:{checkChildAttrs:!0},controls:{checkChildAttrs:!0},includepoints:{},groundoverlays:{checkChildAttrs:!0},coordtype:{},polygons:{checkChildAttrs:!0},showcompass:{enum:["true","false"]},enableoverlooking:{enum:["true","false"]},enablezoom:{enum:["true","false"]},enablescroll:{enum:["true","false"]},enablerotate:{enum:["true","false"]}}},canvas:{atomic:!0,events:["longtap","error"],attrs:{"disable-scroll":{enum:["false","true"]}}},stack:{},richtext:{textContent:!0,atomic:!0,attrs:{type:{required:!0,def:"html"}}},tabs:{events:["change"],children:["tab-content","tab-bar"],attrs:{index:{def:0}}},"tab-content":{parents:["tabs"],attrs:{scrollable:{enum:["true","false"]}}},"tab-bar":{parents:["tabs"],attrs:{mode:{enum:["fixed","scrollable"]}}},popup:{children:["text"],events:["visibilitychange"],attrs:{target:{required:!0},placement:{enum:["bottom","left","right","top","topLeft","topRight","bottomLeft","bottomRight"]}}},rating:{atomic:!0,events:["change"],attrs:{numstars:{checkFunc:"number"},rating:{checkFunc:"number"},stepsize:{checkFunc:"number"},indicator:{enum:["false","true"]}},uevents:["focus","blur","longpress","appear","disappear","swipe","touchstart","touchmove","touchcancel","touchend"]},select:{textContent:!0,events:["change"],children:["option"],uevents:["focus","blur","longpress","appear","disappear","swipe","touchstart","touchmove","touchcancel","touchend"]},option:{atomic:!0,excludeRoot:!0,valueContent:!0,parents:["select"],attrs:{selected:{enum:["false","true"]},value:{required:!0}}}},tagAttrMap={},tagReserved=[],tagAliasMap={},tagDefaultAttrMap={},tagRequireAttrMap={},tagEnumAttrMap={},tagFuncAttrMap={},tagRootAttrMap={},tagChildAttrsMap={},tagPathAttr=[],tagAtomics=[],tagTextCotent=[],tagValueCotent=[],tagChildrenMap={},tagEventsMap={},tagNotRoot=[],tagParentsMap={};Object.keys(tagNatives).forEach(function(t){tagReserved.push(t);var e=tagNatives[t];e.atomic&&tagAtomics.push(t),e.textContent&&tagTextCotent.push(t),e.valueContent&&tagValueCotent.push(t),e.alias&&e.alias.length&&e.alias.forEach(function(e){tagAliasMap[e]=t}),!0===e.excludeRoot&&tagNotRoot.push(t);var a=void 0,n={},o={},r=[],s=[],l=[],i=[];a=e.uattrs?_utils.extend({},e.uattrs):_utils.extend({},tagCommon.attrs,e.attrs),Object.keys(a).forEach(function(e){var t=a[e];t.enum&&0<t.enum.length&&(o[e]=t.enum,n[e]=t.enum[0]),t.def&&(n[e]=t.def),!0===t.required&&s.push(e),1==t.excludeRoot&&i.push(e),t.checkFunc&&(r[e]=t.checkFunc),t.checkChildAttrs&&(l[e]=t.checkChildAttrs),t.checkPath&&tagPathAttr.push(e)}),tagAttrMap[t]=a,tagFuncAttrMap[t]=r,tagDefaultAttrMap[t]=n,tagRequireAttrMap[t]=s,tagEnumAttrMap[t]=o,tagRootAttrMap[t]=i,tagChildAttrsMap[t]=l,tagChildrenMap[t]=e.children?_utils.merge([],tagCommon.children,e.children):null,tagParentsMap[t]=e.parents?_utils.merge([],tagCommon.parents,e.parents):null;var c=void 0;c=e.uevents?_utils.merge([],e.uevents,e.events):_utils.merge([],tagCommon.events,e.events),tagEventsMap[t]=c}),exports.default={checkTagName:checkTagName,checkId:checkId,checkClass:checkClass,checkStyle:checkStyle,checkIf:checkIf,checkElse:checkElse,checkElif:checkElif,checkFor:checkFor,checkEvent:checkEvent,checkAttr:checkAttr,checkBuild:checkBuild,isReservedTag:isReservedTag,isSupportSpan:isSupportSpan,getTagChildren:getTagChildren,isTextContentAomtic:isTextContentAomtic,isSupportedSelfClosing:isSupportedSelfClosing};