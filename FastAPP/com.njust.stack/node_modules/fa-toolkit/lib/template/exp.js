"use strict";var _expression=require("./lib/expression"),_filterParser=require("./lib/filter-parser"),_text=require("./lib/text");function trimHtml(e){if((e=e.replace(/^\s\s+/," ")).length<=1)return e;var r=" "===e.charAt(0)?1:0;return 1<=e.length-(e=e.trim()).length-r&&(e+=" "),r?" "+e:e}function transExpr(expContent,toFunc){var ret=void 0,trimExpContent=expContent.trim();if(_text.isExpr(trimExpContent)){var expList=[],tokens=_text.parseText(trimExpContent),len=tokens.length;tokens.forEach(function(e){if(e.tag){var r=_expression.parseExpression(_filterParser(e.value));1!==len&&(r="("+r+")"),expList.push(r)}else/'/.test(e.value)?expList.push("unescape('"+escape(e.value)+"')"):expList.push("'"+e.value+"'")}),ret=!1!==toFunc?eval("(function () {return "+expList.join("+")+"})"):expList.join(" + ")}else ret=trimHtml(expContent);return ret}function transExprForEvent(funcName,paramsList){var ret=void 0;if(paramsList){var code="("+funcName+"("+paramsList+"))",afterCode=_expression.parseEventFunExp(code),finalCode="(function(evt){"+afterCode.substring(0,afterCode.length-1)+",evt)})";ret=eval(finalCode)}else ret=trimHtml(funcName);return ret}function transExprForList(e){var n=e.match(/{{{(.+?)}}}|{{(.+?)}}/g);if(n&&0<n.length){for(var r=e.replace(/{{{(.+?)}}}|{{(.+?)}}/g,"%s").split(/\s+/),s=0,i=[],t=0,a=r.length;t<a;t++){var p=r[t];0<=p.indexOf("%s")?function(){for(var e=p;0<=(e=e.replace("%s",n[s++])).indexOf("%s"););var r=_text.parseText(e),t=[];r.forEach(function(e){e.tag?t.push(_expression.parseExpression(e.value)):t.push("'"+e.value+"'")}),i.push(t.join("+"))}():i.push("'"+p+"'")}return"(function () {return ["+i.join(", ")+"]})"}return e}transExpr.isExpr=_text.isExpr,transExpr.singleExpr=_text.singleExpr,transExpr.removeExprffix=_text.removeExprffix,transExpr.addExprffix=_text.addExprffix,transExpr.transExprForEvent=transExprForEvent,transExpr.containExpr=_text.containExpr,transExpr.transExprForList=transExprForList,transExpr.removeAllExprFix=_text.removeAllExprFix,module.exports=transExpr;