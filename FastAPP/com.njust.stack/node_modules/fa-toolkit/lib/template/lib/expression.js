"use strict";var esprima=require("esprima"),estraverse=require("estraverse"),escodegen=require("escodegen"),allowedKeywords="Math,Date,this,true,false,null,undefined,Infinity,NaN,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,parseInt,parseFloat,Intl",allowedKeywordsRE=new RegExp("^("+allowedKeywords.replace(/,/g,"\\b|")+"\\b)"),improperKeywords="break,case,class,catch,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,let,return,super,switch,throw,try,var,while,with,yield,enum,await,implements,package,protected,static,interface,private,public",improperKeywordsRE=new RegExp("[^\\W"+improperKeywords.replace(/,/g,"\\b|\\W")+"\\b]"),genOptions={format:{indent:{style:"",base:0,adjustMultilineComment:!1},newline:"",space:"",semicolons:!1,escapeless:!0}},parseOption={range:!0,tolerant:!0,jsx:!0};function parseExpression(r){var t;try{var e=(t=esprima.parseScript("("+r+")",parseOption)).body[0].expression;if(e&&e.expressions&&1<e.expressions.length)throw Error("Object type")}catch(e){try{t=esprima.parseScript("({"+r+"})",parseOption)}catch(e){throw improperKeywordsRE.test(r)?Error("A data binding parsing error occurred. Do not use the reserved field:"+r):Error("A data binding parsing error occurred:"+r)}}return traversFix(t)}function parseEventFunExp(r){try{return traversFix(esprima.parseScript(r,parseOption))}catch(e){throw improperKeywordsRE.test(r)?Error("An event parsing error occurred. Do not use the reserved field:"+r):Error("An event parsing error occurred: "+r)}}function traversFix(e){return estraverse.traverse(e,{enter:function(e,r){r&&"Identifier"===e.type&&(e===r.key||e===r.id||e===r.object||e===r.property&&!0!==r.computed?"Property"===r.type&&r.key.range[0]===r.value.range[0]&&r.key.range[1]===r.value.range[1]?e.name=e.name+":this."+e.name:e!==r.object||allowedKeywordsRE.test(e.name)||(e.name="this."+e.name):"NewExpression"!==r.type?e.name="this."+e.name:allowedKeywordsRE.test(e.name)||(e.name="this."+e.name))}}),escodegen.generate(e,genOptions)}module.exports={parseExpression:parseExpression,parseEventFunExp:parseEventFunExp};