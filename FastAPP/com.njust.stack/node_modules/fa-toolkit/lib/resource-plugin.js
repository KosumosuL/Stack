"use strict";var _fs=require("fs"),_path=require("path"),_os=require("os"),aapt=_path.join(__dirname,"..","bin",_os.platform(),"aapt"),_require=require("child_process"),exec=_require.exec,FILE_EXT_NAME=[".ux",".wux",".mix",".js",".css",".jsx",".coffee",".ts",".tsx",".vue",".less",".sass",".scss",".styl",".html",".md",".json",".DS_Store"],ABILITY_XML=["ability.xml"],dot9PngRegx=/.+\.9\.png$/;function copyFile(e,s){if(_fs.existsSync(e)){var i=_path.join(s,"..");_fs.existsSync(i)&&_fs.statSync(i).isDirectory()||mkParentDir(i);var t=_fs.createReadStream(e),r=_fs.createWriteStream(s);t.pipe(r),t.on("close",function(){r.end()})}}function mkParentDir(e){var s=_path.join(e,"..");_fs.existsSync(s)&&!_fs.statSync(s).isFile()||mkParentDir(s),_fs.mkdirSync(e)}function transFile(a,c,_){var f=void 0,p=_path.join(a,_);_fs.readdirSync(p).forEach(function(e){var s=_path.join(p,e),i=_fs.statSync(s);if(i.isFile()){var t=_path.basename(s),r=_path.extname(s);if(FILE_EXT_NAME.indexOf(r)<0&&".DS_Store"!==t&&ABILITY_XML.indexOf(t.toLowerCase())<0&&!dot9PngRegx.test(t))if(f=_path.join(c,_,_path.basename(e)),_fs.existsSync(f)){var n=_fs.statSync(f);n.isFile()&&n.size!==i.size&&copyFile(s,f)}else copyFile(s,f)}else if(i.isDirectory()){var o=_path.join(_,e);transFile(a,c,o)}})}function ResourcePlugin(e){this.options=e}ResourcePlugin.prototype.apply=function(e){var i=this.options;e.plugin("beforeCompile",function(e,s){transFile(i.src,i.build,""),exec('"'.concat(aapt,'" c -v -S "').concat(i.src,'" -C "').concat(i.build,'"'),function(e){if(e)throw console.error("process png files error : "+e),e})})},module.exports=ResourcePlugin;