"use strict";function _typeof4(e){return(_typeof4="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var esprima=require("esprima"),escodegen=require("escodegen"),LEFT_MODULE_EXPORTS_AST={type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"module"},property:{type:"Identifier",name:"exports"}},_typeof3=function(e){return"function"==typeof Symbol&&"symbol"===_typeof4(Symbol.iterator)?function(e){return _typeof4(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof4(e)}},_typeof2=function(e){return"function"==typeof Symbol&&"symbol"===_typeof3(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof3(e)}:getType(e)},_typeof="function"==typeof Symbol&&"symbol"==_typeof2(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof2(e)};function getType(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof3(e)}function removeAllLoc(e){return JSON.parse(JSON.stringify(e)),function e(t){if(Array.isArray(t))t.forEach(e);else if("object"===(void 0===t?"undefined":_typeof(t)))for(var o in t)"loc"===o?delete t[o]:"range"===o?delete t[o]:"object"===_typeof(t[o])&&e(t[o])}(e),e}function findDataValue(e){var t=void 0,o=void 0,r=void 0,n=void 0;return e&&e.body&&e.body.length&&e.body.forEach(function(e){if("ExpressionStatement"===e.type&&"AssignmentExpression"===(t=e.expression).type&&"="===t.operator&&(o=removeAllLoc(t.left||{}),JSON.stringify(o)===JSON.stringify(LEFT_MODULE_EXPORTS_AST)&&"ObjectExpression"===(r=t.right).type))return r.properties.some(function(e){if("Property"===e.type&&e.key&&"data"===e.key.name&&e.value&&"ObjectExpression"===e.value.type)return n=e,!0})}),n}function convertValueAst(e){return{type:"FunctionExpression",id:null,params:[],defaults:[],body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:e}]},generator:!1,expression:!1}}function format(e,t){var o=esprima.parse(e),r=findDataValue(o);return r?(r.value=convertValueAst(r.value),escodegen.generate(o)):e}function formatBetter(e){var t=findDataValue(esprima.parse(e,{range:!0}));if(t){var o=t.value.range[0],r=t.value.range[1],n=r-o;return e.substr(0,o)+"function () {return "+e.substr(o,n)+"}"+e.substr(r)}return e}exports.fix=formatBetter,exports.formatWhenFix=format;