"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var REGEXP_INT=/^[-+]?[0-9]+$/,REGEXP_URL=/^['"]?([^()]+?)['"]?$/gi,REGEXP_NAME=/^[a-zA-Z_][a-zA-Z0-9]*$/,REGEXP_PACKAGE_NAME=/^[a-z0-9A-Z_.]{3,}$/,REGEXP_COLOR_LONG=/^#[0-9a-fA-F]{6}$/,REGEXP_COLOR_SHORT=/^#[0-9a-fA-F]{3}$/,REGEXP_COLOR_RGB=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/,REGEXP_COLOR_RGBA=/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*\.?\d+)\s*\)$/,MAIN_PKG_NAME="base",_loaderUtils=require("loader-utils"),_path=require("path"),_fs=require("fs"),_utils=require("./utils"),logTypes=["NOTE","WARNING","ERROR"],colorNames={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function validate(e,a){var t=void 0,n=void 0,r=validatorMap[e];return r&&"function"==typeof r.type?(t=r.type(a)).reason&&(n={reason:t.reason(e,a)}):t={value:!0},{value:t.value,log:n}}function makeEnumValidator(e){return validator.enum.bind(null,e)}function validateManifestSubpackages(e,a,t,i,o){var n=/^[a-zA-z]*[0-9]*/,r=/^\w[\w-/]*$/,u=[],l=[],s="",c="",f="",d=0;e.forEach(function(e,a){s=e.name,c=e.resource,e.standalone,f=c&&_path.join(t,c),d=a+1,s?n.test(s)?s===MAIN_PKG_NAME?i.push({line:1,column:1,reason:"ERROR: Subpackage ".concat(d," name '").concat(s,"' is a reserved name of the main package.Please change it."),filePath:o}):-1<u.indexOf(s)?i.push({line:1,column:1,reason:"ERROR: Subpackage ".concat(d," name '").concat(s,"' exists already.Please change it to another one."),filePath:o}):u.push(s):i.push({line:1,column:1,reason:"ERROR: Subpackge ".concat(d," name '").concat(s,"' is invalid. The name can contain only digits, letters, and underscores. Please modify."),filePath:o}):i.push({line:1,column:1,reason:"ERROR: Subpackage ".concat(d," name cannot be blank. Please add one."),filePath:o}),c?r.test(c)?-1<l.indexOf(c)?i.push({line:1,column:1,reason:"ERROR: Subpackage ".concat(d," resource '").concat(c,"'has been used. Please change to another one."),filePath:o}):_fs.existsSync(f)?function(e,a){for(var t=0,n=l.length;t<n;t++){var r=l[t];if(e.startsWith(r)||r.startsWith(e))return i.push({line:1,column:1,reason:"WARNING: Subpackage ".concat(a," resource '").concat(e,"'and subpackage ").concat(t+1," resource'").concat(r,"'are mutually inclusive. Please modify."),filePath:o}),!0}return!1}(c,d)||l.push(c):i.push({line:1,column:1,reason:"ERROR: Subpackage ".concat(d," resource '").concat(c,"', file directory '").concat(f,"' does not exist. Please modify."),filePath:o}):i.push({line:1,column:1,reason:"ERROR: Subpackage ".concat(d," resource name '").concat(c,"' is invalid. The name can only be started with a digit or letter and \n        can consist of only digits, letters, underscores, hyphens, and slashes. Please modify."),filePath:o}):i.push({line:1,column:1,reason:"ERROR: Subpackage ".concat(d," resource name cannot be blank. Please add one."),filePath:o})}),a<1040&&i.push({line:1,column:1,reason:"WARNING: Subpackages have been configured for the project. To enable the subpackages, ensure that minPlatformVersion >= 1040 is configured in the manifest file",filePath:o})}var validator={integer:function(e){return"string"==typeof e?e.match(REGEXP_INT)?{value:!0,reason:function(e,a){return"WARNING: manifest.json configuration item `"+e+"` value `"+a+"` is a character string, which should be an integer instead."}}:{value:!1,reason:function(e,a){return"ERROR: manifest.json configuration item `"+e+"` value `"+a+"` is invalid (the value must be an integer)."}}:(e=(e||"").toString()).match(REGEXP_INT)?{value:!0}:{value:!1,reason:function(e,a){return"ERROR: manifest.json configuration item `"+e+"` value `"+a+"` is invalid (the value must be an integer)."}}},object:function(e){return _utils.isPlainObject(e)?{value:!0}:{value:!1,reason:function(e,a){return"ERROR: manifest.json configuration item `"+e+"` value `"+a+"` is invalid (the value must be an object)."}}},url:function(e){return(e=(e||"").toString().trim()).match(REGEXP_URL)?{value:!0}:{value:!1,reason:function(e,a){return"ERROR: manifest.json configuration item `"+e+"` value `"+a+"`must be an URL."}}},packageName:function(e){return(e=(e||"").toString().trim()).match(REGEXP_PACKAGE_NAME)?{value:!0}:{value:!1,reason:function(e,a){return"ERROR: manifest.json configuration item `"+e+"` value `"+a+"`is invalid."}}},name:function(e){return(e=(e||"").toString()).match(REGEXP_NAME)?{value:!0}:{value:!1,reason:function(e,a){return"ERROR: manifest.json configuration item `"+e+"` value `"+a+"`is in an incorrect format."}}},string:function(e){return{value:!0}},enum:function(t,e){return 0<=t.indexOf(e.toString())?{value:e}:{value:null,reason:function(e,a){return"ERROR: Attribute `"+e+"` value `"+a+"` is invalid (the valid enumerated value is:  `"+t.join("`|`")+"`)"}}},config:function(o){if("{}"===JSON.stringify(o))return{value:!0};var u={},l=[],s=0;return Object.keys(o).forEach(function(e){var a=configValidatorMap[e];if("function"==typeof a){var t=a(o[e]);if("number"!=typeof t.value&&"string"!=typeof t.value&&"boolean"!=typeof t.value||(u[e]=t.value),t.reason){var n=t.reason(e,o[e]),r=n.match(/^([A-Z]+):/);if(r){var i=logTypes.indexOf(r[1]);s<i&&(s=i),n=n.replace(r[0],"")}l.push(n)}}else s=1,l.push(" Attribute `"+e+"` is not a configuration item of config.")}),{value:_utils.isEmptyObject(u)?null:JSON.stringify(u),reason:0<l.length?function(e,a){return logTypes[s]+": configuration item `"+e+"` contains: \n "+l.join(" \n ")}:null}},designWidth:function(e){return"string"==typeof e?e.match(REGEXP_INT)?{value:!0,reason:function(e,a){return"WARNING: In manifest.json, the config configuration item `"+e+"` value `"+a+"` is a character string, which should be an integer instead."}}:{value:!1,reason:function(e,a){return"ERROR: In manifest.json, the config configuration item `"+e+"` value `"+a+"` is invalid (the value must be an integer)."}}:(e=(e||"").toString()).match(REGEXP_INT)?{value:e}:{value:!1,reason:function(e,a){return"ERROR: In manifest.json, the config configuration item `"+e+"` value `"+a+"` is invalid (the value must be an integer)."}}},display:function(o){if("{}"===JSON.stringify(o))return{value:!0};var u={},l=[],s=0;return Object.keys(o).forEach(function(e){var a=displayValidatorMap[e];if("function"==typeof a){var t=a(o[e]);if("number"!=typeof t.value&&"string"!=typeof t.value||(u[e]=t.value),t.reason){var n=t.reason(e,o[e]),r=n.match(/^([A-Z]+):/);if(r){var i=logTypes.indexOf(r[1]);s<i&&(s=i),n=n.replace(r[0],"")}l.push(n)}}else s=1,l.push(" Attribute `"+e+"` is not a configuration item of display.")}),{value:_utils.isEmptyObject(u)?null:JSON.stringify(u),reason:0<l.length?function(e,a){return logTypes[s]+": configuration item `"+e+"` contains: \n "+l.join(" \n ")}:null}},color:function(e){if((e=(e||"").toString()).match(REGEXP_COLOR_LONG))return{value:e};if(e.match(REGEXP_COLOR_SHORT)){var t="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3];return{value:t,reason:function(e,a){return"NOTE: Color value `"+a+"` is converted to `"+t+"`."}}}if(colorNames[e]){var n=colorNames[e];return{value:n,reason:function(e,a){return"NOTE: Color value `"+a+"` is converted to `"+n+"`."}}}var a=void 0,r=void 0,i=void 0,o=REGEXP_COLOR_RGB.exec(e);if(o&&(a=parseInt(o[1]),r=parseInt(o[2]),i=parseInt(o[3]),0<=a&&a<=255&&0<=r&&r<=255&&0<=i&&i<=255))return{value:"rgb("+[a,r,i].join(",")+")"};if(o=REGEXP_COLOR_RGBA.exec(e)){a=parseInt(o[1]),r=parseInt(o[2]),i=parseInt(o[3]);var u=parseFloat(o[4]);if(0<=a&&a<=255&&0<=r&&r<=255&&0<=i&&i<=255&&0<=u&&u<=1)return{value:"rgba("+[a,r,i,u].join(",")+")"}}return"transparent"===e?{value:"rgba(0,0,0,0)"}:{value:null,reason:function(e,a){return"ERROR: Attribute `"+e+"` color value `"+a+"` is invalid.`"}}},widgets:function(a){if("object"!==_typeof(a))return{value:!1,reason:function(e,a){return"ERROR: Configuration item `"+e+"` value `"+a+"` is invalid."}};if(0===a.length)return{value:!0,reason:function(e,a){return"NOTE: Configuration item `"+e+" is not a mandatory item of manifest."}};var c={},f=[],d=0,t=[];Object.keys(widgetsValidatorMap).forEach(function(e){widgetsValidatorMap[e].require&&t.push(e)});for(var e=function(e){var l=a[e],s=[].concat(t);l?(Object.keys(l).forEach(function(e){var a=widgetsValidatorMap[e];if(void 0!==a){if(-1!==s.indexOf(e)){var t=s.indexOf(e);s.splice(t,1)}var n=a.type;if(!n||"function"!=typeof n)return{value:!0};var r=n(l[e]);if("number"!=typeof r.value&&"string"!=typeof r.value&&"boolean"!=typeof r.value||(c[e]=r.value),r.reason){var i=r.reason(e,l[e]),o=i.match(/^([A-Z]+):/);if(o){var u=logTypes.indexOf(o[1]);d<u&&(d=u),i=i.replace(o[0],"")}f.push(i)}}else d=1,f.push(" Attribute `"+e+"`is not a configuration item of widgets.")}),0<s.length&&(d=2,f.push(" In widgets, card "+(e+1)+" does not contain the mandatory attribute: "+s.join(", ")))):(d=2,f.push(" In widgets, card "+(e+1)+" is not configured. Enter the mandatory attribtes and parameters."))},n=0;n<a.length;n++)e(n);return{value:_utils.isEmptyObject(c)?null:JSON.stringify(c),reason:0<f.length?function(e,a){return logTypes[d]+": configuration item `"+e+"` contains: \n "+f.join(" \n ")}:null}},params:function(a){if("object"!==_typeof(a))return{value:!1,reason:function(e,a){return"ERROR: Attribute  `"+e+"` value `"+a+"` is invalid (the value can only be a list)."}};if(0===a.length)return{value:!0};var c={},f=[],d=0,t=[];Object.keys(paramsValidatorMap).forEach(function(e){paramsValidatorMap[e].require&&t.push(e)});for(var e=function(e){var l=a[e],s=[].concat(t);l?(Object.keys(l).forEach(function(e){var a=paramsValidatorMap[e];if(void 0!==a){if(-1!==s.indexOf(e)){var t=s.indexOf(e);s.splice(t,1)}var n=a.type;if(!n||"function"!=typeof n)return{value:!0};var r=n(l[e]);if("number"!=typeof r.value&&"string"!=typeof r.value&&"boolean"!=typeof r.value||(c[e]=r.value),r.reason){var i=r.reason(e,l[e]),o=i.match(/^([A-Z]+):/);if(o){var u=logTypes.indexOf(o[1]);d<u&&(d=u),i=i.replace(o[0],"")}f.push(i)}}else d=1,f.push(" Attribute `"+e+"`is not a configuration item of params.")}),0<s.length&&(d=1,f.push(" In params, object "+(e+1)+" does not contain the mandatory attribute: "+s.join(", ")))):(d=1,f.push(" In params, object"+(e+1)+" is not configured. Enter the mandatory attribtes and parameters."))},n=0;n<a.length;n++)e(n);return{value:_utils.isEmptyObject(c)?null:JSON.stringify(c),reason:0<f.length?function(e,a){return logTypes[d]+": attribute `"+e+"` contains: \n "+f.join(" \n ")}:null}},list:function(e){if("object"!==_typeof(e))return{value:!1,reason:function(e,a){return"ERROR: Attribute  `"+e+"` value `"+a+"` is invalid (the value can only be a list)."}};if(0===e.length)return{value:!0};for(var t=["ACCESS_FINE_LOCATION","WRITE_CALENDAR"],n=[],a=0;a<e.length;a++)-1===t.indexOf(e[a])&&n.push(e[a]);return 0===n.length?{value:!0}:{value:!1,reason:function(e,a){return"ERROR: Attribute `"+e+"` contains an invalid value `"+n.join(", ")+"` (the value can only be "+t.join(", ")+")."}}},data:function(e){if(_utils.isPlainObject(e)){var t=[];return Object.keys(e).forEach(function(e){var a=e.match(/^\$|^_/);a&&t.push(a[0])}),t.length?{value:!1,reason:function(e,a){return"ERROR: Attribute `"+e+"` key value must be started with `$` or `_`."}}:{value:e}}return{value:!1,reason:function(e,a){return"ERROR: Attribute  `"+e+"` value `"+a+"` is invalid (the value can only be an object)."}}},array:function(e){return Array.isArray(e)?{value:e}:{value:!1,reason:function(e,a){return"ERROR: Attribute  `"+e+"` value `"+a+"` is invalid (the value can only be an array)."}}},pages:function(s){if(_utils.isPlainObject(s)){var a,c,e=function(){a=[],Object.keys(s).forEach(function(e){a.push(e)});var t=[];for(c=0;c<a.length;c++)-1===routerPagesMap.indexOf(a[c])&&t.push(a[c]);if(0<t.length)return{v:{value:!1,reason:function(e,a){return"ERROR: Page `"+t.join(", ")+"`is not defined in router pages."}}};var o={},u=[],l=0;for(c in s)Object.keys(s[c]).forEach(function(e){var a=pagesValidatorMap[e];if("function"==typeof a){var t=a(s[c][e]);if("number"!=typeof t.value&&"string"!=typeof t.value||(o[e]=t.value),t.reason){var n=t.reason(e,s[c][e]),r=n.match(/^([A-Z]+):/);if(r){var i=logTypes.indexOf(r[1]);l<i&&(l=i),n=n.replace(r[0],"")}u.push(n)}}else l=1,u.push(" Attribute `"+e+"` is not a configuration item of pages.")});return{v:{value:_utils.isEmptyObject(o)?null:JSON.stringify(o),reason:0<u.length?function(e,a){return logTypes[l]+": configuration item `"+e+"` contains: \n "+u.join(" \n ")}:null}}}();if("object"===_typeof(e))return e.v}return{value:!1,reason:function(e,a){return"ERROR: Attribute  `"+e+"` value `"+a+"` is invalid (the value can only be an object)."}}}},validatorMap={package:{type:validator.packageName,require:!0},name:{type:validator.string,require:!0},versionCode:{type:validator.integer,require:!0},minPlatformVersion:{type:validator.integer,require:!0},isPlugin:{type:makeEnumValidator(["false","true"]),require:!1},"uses-permission":{type:validator.string,require:!1},icon:{type:validator.url,require:!0},config:{type:validator.config,require:!0},router:{type:validator.object,require:!0},display:{type:validator.display,require:!1},widgets:{type:validator.widgets,require:!1},subpackages:{type:validator.subpackages,require:!1}},widgetsValidatorMap={name:{type:validator.string,require:!0},id:{type:validator.string,require:!0},path:{type:validator.string,require:!0},component:{type:validator.string,require:!1},targetManufactorys:{type:validator.array,require:!0},desc:{type:validator.string,require:!1},params:{type:validator.params,require:!1},"uses-permission":{type:validator.list,require:!1},minPlatformVersion:{type:validator.integer,require:!0},distribute:{type:validator.string,require:!1}},paramsValidatorMap={name:{type:validator.string,require:!0},mandatory:{type:makeEnumValidator(["true","false"]),require:!1},valueSample:{type:validator.string,require:!0},desc:{type:validator.string,require:!0}},configValidatorMap={logLevel:makeEnumValidator(["log","off","error","warn","info","debug"]),designWidth:validator.designWidth,data:validator.data},displayValidatorMap={backgroundColor:validator.color,fullScreen:makeEnumValidator(["true","false"]),titleBar:makeEnumValidator(["true","false"]),titleBarBackgroundColor:validator.color,titleBarTextColor:validator.color,titleBarText:validator.string,menu:makeEnumValidator(["true","false"]),pages:validator.pages,windowSoftInputMode:makeEnumValidator(["adjustPan","adjustResize"]),orientation:makeEnumValidator(["portrait","landscape"])},pagesValidatorMap={backgroundColor:validator.color,fullScreen:makeEnumValidator(["true","false"]),titleBar:makeEnumValidator(["true","false"]),titleBarBackgroundColor:validator.color,titleBarTextColor:validator.color,titleBarText:validator.string,menu:makeEnumValidator(["true","false"]),windowSoftInputMode:makeEnumValidator(["adjustPan","adjustResize"]),orientation:makeEnumValidator(["portrait","landscape"])},routerPagesMap=[],requireAttrMap=[];Object.keys(validatorMap).forEach(function(e){validatorMap[e].require&&requireAttrMap.push(e)}),module.exports=function(e){var a=this.resourcePath,t=this.options.versionNum,n=JSON.parse(e);if(n){var r=[];if(requireAttrMap.forEach(function(e){n[e]||r.push({line:1,column:1,reason:"ERROR: Manifest.json does not contain configuration item `"+e+"`",filePath:a})}),Object.keys(n.router.pages).forEach(function(e){routerPagesMap.push(e)}),n.subpackages&&1<n.subpackages.length)validateManifestSubpackages(n.subpackages,t,_path.dirname(a),r,a);var i=void 0;Object.keys(n).forEach(function(e){(i=validate(e,n[e])).log&&r.push({line:1,column:1,reason:i.log.reason,filePath:a})}),_utils.logWarn(this,r)}return e};